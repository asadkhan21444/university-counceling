{% extends 'My_Admin/base1.html' %}

{% block title %}Counsellor Availability{% endblock %}
{% block page_title %}Counsellor Availability List{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between mb-3">
        <h4>All Counsellor Availabilities</h4>
        <a href="{% url 'availability_add' %}" class="btn btn-primary">+ Add Availability</a>
    </div>

    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Counsellor</th>
                <th>Day</th>
                <th>Start</th>
                <th>End</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for availability in availabilities %}
            <tr>
                <td>{{ availability.id }}</td>
                <td>{{ availability.counsellor.user.username }}</td>
                <td>{{ availability.get_day_of_week_display }}</td>
                <td>{{ availability.start_time }}</td>
                <td>{{ availability.end_time }}</td>
                <td>
                    {% if availability.is_active %}
                        <span class="badge bg-success">Active</span>
                    {% else %}
                        <span class="badge bg-secondary">Inactive</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'availability_update' availability.id %}" class="btn btn-sm btn-warning">Edit</a>
                    <button class="btn btn-sm btn-danger delete-btn" data-id="{{ availability.id }}">Delete</button>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="7" class="text-center">No records found.</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- SweetAlert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.querySelectorAll('.delete-btn').forEach(button => {
    button.addEventListener('click', function() {
        const recordId = this.dataset.id;
        Swal.fire({
            title: 'Are you sure?',
            text: "This record will be permanently deleted!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                fetch(`/availability/delete/${recordId}/`, {
                    method: 'POST',
                    headers: { 'X-CSRFToken': '{{ csrf_token }}' }
                })
                .then(res => res.json())
                .then(data => {
                    if(data.success){
                        Swal.fire('Deleted!','Record deleted successfully.','success')
                        .then(() => location.reload());
                    } else {
                        Swal.fire('Error!', data.error || 'Something went wrong.','error');
                    }
                });
            }
        });
    });
});
</script>
{% endblock %}
