{% extends 'My_Admin/base1.html' %}

{% block title %}Student Records{% endblock %}
{% block page_title %}Manage Students{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between mb-3">
        <h3>All Students</h3>
        <a href="{% url 'student_add' %}" class="btn btn-primary">+ Add Student</a>
    </div>

    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Faculty</th>
                <th>Department</th>
                <th>Year</th>
                <th>Emergency Contact</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
            <tr>
                <td>{{ student.student_id }}</td>
                <td>{{ student.user.get_full_name }}</td>
                <td>{{ student.get_faculty_display }}</td>
                <td>{{ student.department }}</td>
                <td>{{ student.academic_year }}</td>
                <td>{{ student.emergency_contact_name }} ({{ student.emergency_contact_phone }})</td>
                <td>
                    <a href="{% url 'student_update' student.pk %}" class="btn btn-sm btn-warning">Edit</a>
                    <button class="btn btn-sm btn-danger" onclick="deleteStudent('{{ student.pk }}')">Delete</button>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="7" class="text-center">No records found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- SweetAlert Delete -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function deleteStudent(studentId) {
    Swal.fire({
        title: "Are you sure?",
        text: "This record will be permanently deleted!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#d33",
        cancelButtonColor: "#3085d6",
        confirmButtonText: "Yes, delete it!"
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/students/delete/${studentId}/`, {
                method: "POST",
                headers: { "X-CSRFToken": "{{ csrf_token }}" }
            }).then(response => {
                if (response.ok) {
                    Swal.fire("Deleted!", "The student has been deleted.", "success")
                        .then(() => location.reload());
                } else {
                    Swal.fire("Error!", "Could not delete the student.", "error");
                }
            });
        }
    });
}
</script>
{% endblock %}
