{% extends 'My_Student/base1.html' %}

{% block title %}Emergency Contacts - University Counselling System{% endblock %}

{% block page_title %}Emergency Contacts{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>All Emergency Contacts</h3>
        <!-- <a href="{% url 'emergency_contact_add' %}" class="btn btn-primary">+ Add Contact</a> -->
    </div>

    <table class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>Student</th>
                <th>Name</th>
                <th>Relationship</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Primary</th>
                <!-- <th>Actions</th> -->
            </tr>
        </thead>
        <tbody>
            {% for contact in contacts %}
            <tr>
                <td>{{ contact.student.user.username }}</td>
                <td>{{ contact.name }}</td>
                <td>{{ contact.relationship }}</td>
                <td>{{ contact.phone_number }}</td>
                <td>{{ contact.email|default:"-" }}</td>
                <td>
                    {% if contact.is_primary %}
                        <span class="badge bg-success">Yes</span>
                    {% else %}
                        <span class="badge bg-secondary">No</span>
                    {% endif %}
                </td>
                <!-- <td>
                    <a href="{% url 'emergency_contact_update' contact.pk %}" class="btn btn-sm btn-warning">Edit</a>
                    <a href="{% url 'emergency_contact_delete' contact.pk %}" 
                       class="btn btn-sm btn-danger btn-delete"
                       data-name="{{ contact.name }}">Delete</a>
                </td> -->
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center text-muted">No emergency contacts found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- SweetAlert Delete Confirmation -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.querySelectorAll('.btn-delete').forEach(btn => {
    btn.addEventListener('click', function(e) {
        e.preventDefault();
        let url = this.getAttribute('href');
        let name = this.dataset.name;

        Swal.fire({
            title: 'Are you sure?',
            text: `Delete emergency contact: ${name}?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = url;
            }
        });
    });
});

// SweetAlert for Django messages
{% if messages %}
    {% for message in messages %}
        Swal.fire({
            icon: "{% if message.tags == 'success' %}success{% else %}error{% endif %}",
            title: "{{ message }}",
            timer: 2000,
            showConfirmButton: false
        });
    {% endfor %}
{% endif %}
</script>
{% endblock %}
